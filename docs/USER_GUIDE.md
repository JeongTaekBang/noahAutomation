# NOAH_SO_PO_DN 사용 가이드

## 시트 구성

| 시트 | 역할 | 언제 입력? |
|------|------|-----------|
| **SO_국내/해외** | 고객 발주 | 고객 발주 접수할 때 |
| **PO_국내/해외** | 공장 발주 + 사양 | 공장에 발주할 때 |
| **DN_국내/해외** | 납품 + 세금계산서 | 납품할 때 |
| **PMT_국내/해외** | 입금 (선수금/잔금) | 입금 받을 때 |

---

## 시트 관계도

```
                    ┌─────────────────────────────────┐
                    │            SO (고객 발주)        │
                    │  SOX-2026-0001, 고객명, 모델, 수량 │
                    └────────────────┬────────────────┘
                                     │
                                     │ SO_ID로 연결
           ┌─────────────────────────┼─────────────────────────┐
           │                         │                         │
           ▼                         ▼                         ▼
┌─────────────────────┐   ┌─────────────────────┐   ┌─────────────────────┐
│    PO (공장 발주)    │   │     DN (납품)       │   │    PMT (입금)       │
│                     │   │                     │   │                     │
│ SO 정보 자동 표시    │   │ 납품일, 수량        │   │ 선수금/잔금         │
│ + 사양/옵션 직접입력 │   │ 세금계산서 번호     │   │ 금액, 입금일        │
│                     │   │                     │   │                     │
│ ※ SO와 행번호 동기화 │   │ ※ 분할납품 가능     │   │ ※ 여러번 입금 가능  │
└─────────────────────┘   └─────────────────────┘   └─────────────────────┘

        1:1 연결                  1:N 연결                 1:N 연결
   (SO 2행 = PO 2행)        (같은 SO_ID 여러 행)     (같은 SO_ID 여러 행)
```

**핵심: 모든 시트는 SO_ID로 연결됩니다.**

---

## 입력 순서

```
1. 고객 발주 접수  →  SO 시트에 입력 (SO_ID 생성)
         ↓
2. 선수금 입금     →  PMT 시트에 입력 (있는 경우)
         ↓
3. 공장 발주       →  PO 시트에 사양/옵션 입력
         ↓
4. 납품           →  DN 시트에 입력
         ↓
5. 세금계산서      →  DN 시트에 세금계산서 번호 입력
```

---

## 시트별 입력 방법

### SO (고객 발주)

고객 발주 접수하면 여기에 입력합니다.

- **SO_ID**: `SOX-2026-0001` 형식으로 직접 생성
- 같은 주문에 품목이 여러 개면 → **같은 SO_ID**로 여러 행 입력

```
예시: 주문 1건에 품목 3개
┌──────────────┬────────┬───────┬──────┐
│ SO_ID        │ 고객명 │ 모델  │ 수량 │
├──────────────┼────────┼───────┼──────┤
│ SOX-2026-0001 │ A사    │ IQ10  │ 10   │
│ SOX-2026-0001 │ A사    │ IQ18  │ 20   │  ← 같은 SO_ID
│ SOX-2026-0001 │ A사    │ IQ25  │ 5    │  ← 같은 SO_ID
└──────────────┴────────┴───────┴──────┘
```

---

### PO (공장 발주)

공장에 발주할 때 사양/옵션을 입력합니다.

- **SO 정보는 자동으로 표시됨** (수식으로 연결)
- 직접 입력하는 것: RCK Order no., 사양, 옵션(Y/N)
- **SO와 같은 행에 입력** (SO 2행 = PO 2행)

```
┌──────────────┬────────┬───────────┬─────────────┐
│ SO_ID        │ 고객명 │ RCK Order │ 사양/옵션   │
│ (자동표시)   │(자동)  │ (직접)    │ (직접)      │
├──────────────┼────────┼───────────┼─────────────┤
│ SO-2026-0001 │ A사    │ ND-0001   │ ...         │
└──────────────┴────────┴───────────┴─────────────┘
```

---

### DN (납품)

납품할 때 입력합니다. 세금계산서 발행하면 여기에 기록합니다.

- SO_ID로 연결 (어떤 주문인지)
- **분할 납품 가능** → 같은 SO_ID로 여러 행 추가

```
예시: 100개 주문 → 60개 먼저 납품 → 40개 나중에 납품
┌──────────────┬───────────┬──────┬──────────────┐
│ SO_ID        │ 납품일    │ 수량 │ 세금계산서   │
├──────────────┼───────────┼──────┼──────────────┤
│ SO-2026-0001 │ 1/20      │ 60   │ 2026-00123   │
│ SO-2026-0001 │ 1/25      │ 40   │ 2026-00145   │  ← 분할 납품
└──────────────┴───────────┴──────┴──────────────┘
```

---

### PMT (입금)

선수금 받으면 입력합니다.

- 구분: 선수금

```
┌──────────────┬────────┬──────────┬────────────┐
│ SO_ID        │ 구분   │ 금액     │ 입금일     │
├──────────────┼────────┼──────────┼────────────┤
│ SO-2026-0001 │ 선수금 │ 500만    │ 1/12       │
│ SO-2026-0001 │ 잔금   │ 500만    │ 1/26       │
└──────────────┴────────┴──────────┴────────────┘
```

---

## 주의사항

### 1. 행 삭제 금지 (SO/PO)
- SO와 PO는 행 번호가 연결되어 있음
- **행을 삭제하면 데이터가 꼬임**
- 잘못 입력했으면 → 내용만 지우고 행은 그대로

### 2. SO_ID는 통일
- 같은 주문은 항상 **같은 SO_ID** 사용
- DN, PMT에서도 같은 SO_ID로 연결

### 3. 데이터 새로고침
- 파워피벗 사용 시: 데이터 탭 → **모두 새로 고침**

---

## 문서 생성 CLI

### PO (발주서)
```bash
python create_po.py ND-0001                  # 단일 발주
python create_po.py ND-0001 ND-0002          # 여러 건 동시
python create_po.py ND-0001 --force          # 중복/검증 오류 무시
python create_po.py --history                # 현재 월 이력 조회
python create_po.py --history --export       # 이력 Excel 내보내기
```

### 거래명세표 (국내)
```bash
python create_ts.py DND-2026-0001            # 단건 (납품)
python create_ts.py ADV_2026-0001            # 선수금
python create_ts.py DND-2026-0001 DND-2026-0002 --merge  # 월합 (여러 DN → 1장)
python create_ts.py --interactive --merge    # 대화형 모드 (DN 목록 붙여넣기)
```

### Proforma Invoice (해외 견적)
```bash
python create_pi.py SOO-2026-0001            # SO_ID 기반
```

### Final Invoice (해외 대금 청구)
```bash
python create_fi.py DNO-2026-0001            # DN_ID 기반 (DN_해외 + Customer_해외)
```

### 주요 CLI 옵션

| 옵션 | 대상 | 설명 |
|------|------|------|
| `--force` (`-f`) | PO | 중복 체크 및 검증 오류 무시하고 강제 생성 |
| `--merge` (`-m`) | TS | 여러 DN을 한 장의 거래명세표로 합침 |
| `--interactive` (`-i`) | TS | DN 목록을 세로로 붙여넣기할 수 있는 대화형 모드 |
| `--history` | PO | 현재 월 발주 이력 조회 |
| `--export` | PO | 이력을 Excel 파일로 내보내기 (`--history`와 함께 사용) |
| `--verbose` (`-v`) | 전체 | DEBUG 레벨 로깅 활성화 |

### 또는 배치 파일로 실행

`create_po.bat` 더블클릭 → 대화형 메뉴에서 문서 유형 선택 (PO, TS, PI, FI)

---

## 현황 확인 방법

| 확인할 내용 | 방법 |
|-------------|------|
| 공장 발주 안 된 건 | PO에서 RCK Order가 비어있는 행 |
| 납품 안 된 건 | DN에 해당 SO_ID가 없음 |
| 세금계산서 미발행 | DN에서 세금계산서 번호가 비어있는 행 |
| 선수금 안 받은 건 | PMT에 "선수금" 기록이 없음 |

---
